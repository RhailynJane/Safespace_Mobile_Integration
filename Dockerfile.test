# Dockerfile for running Jest tests in Docker
FROM node:22-alpine

# Set working directory
WORKDIR /app

# Install dependencies required for React Native testing
# Add retry logic and use different mirror if needed
RUN apk update && \
    apk add --no-cache \
    git \
    python3 \
    make \
    g++ \
    bash \
    curl \
    || (sleep 5 && apk update && apk add --no-cache git python3 make g++ bash curl)

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm ci --legacy-peer-deps

# Copy the rest of the application
COPY . .

# Set environment to test
ENV NODE_ENV=test
ENV CI=true

# Default command runs all tests
CMD ["npm", "test", "--", "--coverage", "--watchAll=false", "--verbose", "--passWithNoTests"]
